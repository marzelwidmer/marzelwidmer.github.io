<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://marzelwidmer.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/light.css' />
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://marzelwidmer.github.io/css/syntax.css' />
    <title>Kubernetes Ingress with Ngnix Ingress Controller - Marcel Widmer</title>
    
    <link rel="icon" type="image/x-icon" href='https://marzelwidmer.github.io/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="OSX Minikube Kubernetes If you use ohmyzsh is there a nice Plugin with some kubectl for more details check ohmyzsh plugins kubectl
Install Minikube with Ingress Controller brew install minikube Start Minikube minikube start üòÑ minikube v1.9.2 on Darwin 10.15.4 ‚ñ™ MINIKUBE_ACTIVE_DOCKERD=minikube ‚ú® Using the hyperkit driver based on existing profile üëç Starting control plane node m01 in cluster minikube üîÑ Restarting existing hyperkit VM for &amp;#34;minikube&amp;#34; ... üê≥ Preparing Kubernetes v1." />
<meta name="keywords"
  content='google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://marzelwidmer.github.io/post/blog/2020/2020-05-01-minikube-ingress-controller/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Kubernetes Ingress with Ngnix Ingress Controller - Marcel Widmer" />
<meta name="twitter:description"
  content="OSX Minikube Kubernetes If you use ohmyzsh is there a nice Plugin with some kubectl for more details check ohmyzsh plugins kubectl
Install Minikube with Ingress Controller brew install minikube Start Minikube minikube start üòÑ minikube v1.9.2 on Darwin 10.15.4 ‚ñ™ MINIKUBE_ACTIVE_DOCKERD=minikube ‚ú® Using the hyperkit driver based on existing profile üëç Starting control plane node m01 in cluster minikube üîÑ Restarting existing hyperkit VM for &amp;#34;minikube&amp;#34; ... üê≥ Preparing Kubernetes v1." />
<meta name="twitter:site" content="https://marzelwidmer.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://marzelwidmer.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Kubernetes Ingress with Ngnix Ingress Controller - Marcel Widmer">
<meta property="og:description"
  content="OSX Minikube Kubernetes If you use ohmyzsh is there a nice Plugin with some kubectl for more details check ohmyzsh plugins kubectl
Install Minikube with Ingress Controller brew install minikube Start Minikube minikube start üòÑ minikube v1.9.2 on Darwin 10.15.4 ‚ñ™ MINIKUBE_ACTIVE_DOCKERD=minikube ‚ú® Using the hyperkit driver based on existing profile üëç Starting control plane node m01 in cluster minikube üîÑ Restarting existing hyperkit VM for &amp;#34;minikube&amp;#34; ... üê≥ Preparing Kubernetes v1." />
<meta property="og:url" content="https://marzelwidmer.github.io/post/blog/2020/2020-05-01-minikube-ingress-controller/" />
<meta property="og:site_name" content="Kubernetes Ingress with Ngnix Ingress Controller" />
<meta property="og:image"
  content="https://marzelwidmer.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2020-05-01 00:00:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://marzelwidmer.github.io/">
        <img class="octicon" height="32" width="32" src="/images/GitHub-Mark-Light-32px.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <img height="24" class="octicon octicon-three-bars" width="24" src="/images/GitHub-Mark-Light-32px.png">
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://marzelwidmer.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://marzelwidmer.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/GitHub-Mark-Light-32px.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://marzelwidmer.github.io/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://marzelwidmer.github.io/">Marcel Widmer</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://marzelwidmer.github.io/post/blog/2020/2020-05-01-minikube-ingress-controller/">Kubernetes Ingress with Ngnix Ingress Controller</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Fri, 01 May 2020 00:00:00 &#43;0000"
                    class="no-wrap">
                    Fri, 01 May 2020 00:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Fri, 16 Feb 2024 08:20:05 &#43;0100"
                    class="no-wrap">
                    Fri, 16 Feb 2024 08:20:05 &#43;0100</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1319 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/k8s">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      k8s
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="osx-minikube-kubernetes">OSX Minikube Kubernetes</h1>
<p>If you use <code>ohmyzsh</code>  is there a nice Plugin with some <code>kubectl</code> for more details check <a href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/kubectl">ohmyzsh plugins kubectl</a></p>
<h2 id="install-minikube-with-ingress-controller">Install Minikube with Ingress Controller</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install minikube
</span></span></code></pre></div><h2 id="start-minikube">Start Minikube</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube start
</span></span><span class="line"><span class="cl">üòÑ  minikube v1.9.2 on Darwin 10.15.4
</span></span><span class="line"><span class="cl">    ‚ñ™ <span class="nv">MINIKUBE_ACTIVE_DOCKERD</span><span class="o">=</span>minikube
</span></span><span class="line"><span class="cl">‚ú®  Using the hyperkit driver based on existing profile
</span></span><span class="line"><span class="cl">üëç  Starting control plane node m01 in cluster minikube
</span></span><span class="line"><span class="cl">üîÑ  Restarting existing hyperkit VM <span class="k">for</span> <span class="s2">&#34;minikube&#34;</span> ...
</span></span><span class="line"><span class="cl">üê≥  Preparing Kubernetes v1.18.0 on Docker 19.03.8 ...
</span></span><span class="line"><span class="cl">üåü  Enabling addons: dashboard, default-storageclass, ingress, storage-provisioner
</span></span><span class="line"><span class="cl">üèÑ  Done! kubectl is now configured to use <span class="s2">&#34;minikube&#34;</span>
</span></span></code></pre></div><h2 id="minkikube-status">Minkikube Status</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube status
</span></span><span class="line"><span class="cl">m01
</span></span><span class="line"><span class="cl">host: Running
</span></span><span class="line"><span class="cl">kubelet: Running
</span></span><span class="line"><span class="cl">apiserver: Running
</span></span><span class="line"><span class="cl">kubeconfig: Configured
</span></span></code></pre></div><h2 id="enable-ingress-addons">Enable Ingress Addons</h2>
<p>We need the addon <code>ingress</code> this can be done with the followng command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube addons <span class="nb">enable</span> ingress
</span></span></code></pre></div><p>Check minikube addons with <code>minikube addons list</code> if <code>ingress</code> is enabled.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube addons list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">|</span>-----------------------------<span class="p">|</span>----------<span class="p">|</span>--------------<span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>         ADDON NAME          <span class="p">|</span> PROFILE  <span class="p">|</span>    STATUS    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-----------------------------<span class="p">|</span>----------<span class="p">|</span>--------------<span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> dashboard                   <span class="p">|</span> minikube <span class="p">|</span> enabled ‚úÖ   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> default-storageclass        <span class="p">|</span> minikube <span class="p">|</span> enabled ‚úÖ   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> efk                         <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> freshpod                    <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> gvisor                      <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> helm-tiller                 <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ingress                     <span class="p">|</span> minikube <span class="p">|</span> enabled ‚úÖ   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ingress-dns                 <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> istio                       <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> istio-provisioner           <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> logviewer                   <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> metrics-server              <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> nvidia-driver-installer     <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> nvidia-gpu-device-plugin    <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> registry                    <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> registry-aliases            <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> registry-creds              <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> storage-provisioner         <span class="p">|</span> minikube <span class="p">|</span> enabled ‚úÖ   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> storage-provisioner-gluster <span class="p">|</span> minikube <span class="p">|</span> disabled     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-----------------------------<span class="p">|</span>----------<span class="p">|</span>--------------<span class="p">|</span>
</span></span></code></pre></div><h2 id="ingress-controller">Ingress Controller</h2>
<p>Let&rsquo;s check if the <code>Nginx Ingress Controller</code> is up and running.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get pods -n kube-system <span class="p">|</span> grep nginx-ingress
</span></span><span class="line"><span class="cl">nginx-ingress-controller-6d57c87cb9-rtgpk   1/1     Running   <span class="m">1</span>          12m
</span></span></code></pre></div><h1 id="create-namespace">Create Namespace</h1>
<p>Let&rsquo;s create first a <code>dev</code> name space where we deploy our sample application.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k create ns dev
</span></span><span class="line"><span class="cl">namespace/dev created
</span></span></code></pre></div><h1 id="switch-namespace-permanently">Switch Namespace Permanently</h1>
<p>With the following command we can switch the namespace permanently like <code>oc project</code> in a <code>OpenShift</code> environment.
This command will save the namespace for all other <code>kubectl</code> commands in that context.
This required the <a href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/kubectl">ohmyzsh plugins kubectl</a> Plugin.
Without this plugin will be the command <code>kubectl config set-context --current --namespace=dev</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kcn dev
</span></span></code></pre></div><h1 id="create-deployment">Create Deployment</h1>
<p>Let&rsquo;s create a deployment now for a sample application with the name <code>myapp</code> with the image <code>google-samples/hello-app:1.0</code> in the current namespace <code>dev</code></p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k create deployment myapp --image<span class="o">=</span>gcr.io/google-samples/hello-app:1.0
</span></span><span class="line"><span class="cl">deployment.apps/myapp created
</span></span></code></pre></div><p>If you want see what deployments we have you can use <code>kubectl get deployments</code> command.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get deployments
</span></span><span class="line"><span class="cl">NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">myapp   1/1     <span class="m">1</span>            <span class="m">1</span>           44m
</span></span></code></pre></div><p>Let&rsquo;s also check if the pod is running.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get pods -n dev -o wide --show-labels --field-selector<span class="o">=</span>status.phase<span class="o">=</span>Running
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                    READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES   LABELS
</span></span><span class="line"><span class="cl">myapp-75d86849b-2gbps   1/1     Running   <span class="m">0</span>          67m   172.17.0.3   minikube   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>myapp,pod-template-hash<span class="o">=</span>75d86849b
</span></span></code></pre></div><h1 id="create-service">Create Service</h1>
<p>To reach our application we have to create a <code>service</code> this can be easily done with the <code>expose</code> command and the <code>NodePort</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k expose deployment myapp --port<span class="o">=</span><span class="m">8080</span> --type<span class="o">=</span>NodePort
</span></span></code></pre></div><p>Let&rsquo;s check the service.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get svc
</span></span><span class="line"><span class="cl">NAME    TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
</span></span><span class="line"><span class="cl">myapp   NodePort   10.110.101.126   &lt;none&gt;        8080:30506/TCP   21m
</span></span></code></pre></div><h2 id="test-service-internal-in-a-cluster">Test Service internal in a Cluster</h2>
<p>Let&rsquo;s check the service with a small container based on the <code>tutum/curl:alpine</code> Docker image, which contains the curl command.
Run the <code>curl -s 'http://myapp:8080'</code> command inside the container and redirect the output to the Terminal using the <code>-i</code> option.
Delete the pod using the <code>--rm</code> option.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k run -i --rm --restart<span class="o">=</span>Never curl-client --image<span class="o">=</span>tutum/curl:alpine --command -- curl -s <span class="s1">&#39;http://myapp:8080&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 1.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp-75d86849b-2gbps
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;curl-client&#34;</span> deleted
</span></span></code></pre></div><p>This mean we can call a pod internal a cluster with the internal <code>DNS</code>.</p>
<h2 id="test-service-outside-a-cluster">Test Service outside a Cluster</h2>
<p>Let&rsquo;s call again the command <code>k get svc</code> to get the exposed port from out service.
Run the following command again :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get svc
</span></span><span class="line"><span class="cl">NAME    TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
</span></span><span class="line"><span class="cl">myapp   NodePort   10.110.101.126   &lt;none&gt;        8080:30506/TCP   21m
</span></span></code></pre></div><p>You see the exposed port is here <code>30506</code> now let&rsquo;s get the <code>IP</code> address from out minikube with <code>minikube ip</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">minikube ip
</span></span><span class="line"><span class="cl">192.168.64.18
</span></span></code></pre></div><p>Now let&rsquo;s also call out service <code>myapp</code> with <code>HTTPie</code> or in a browser <code>http://192.168.64.18:30506</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http http://192.168.64.18:30506
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">61</span>
</span></span><span class="line"><span class="cl">Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">03</span> May <span class="m">2020</span> 08:07:35 GMT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 1.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp-75d86849b-2gbps
</span></span></code></pre></div><h1 id="etchosts">/etc/hosts</h1>
<p>To get on the service with the URL <code>minikube.me</code> we update now out local <code>/etc/hosts</code> file with <code>IP</code> address from your minikube <code>minikube ip</code>
Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="k">$(</span>minikube ip<span class="k">)</span> minikube.me <span class="p">|</span> sudo tee -a /etc/hosts
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl">192.168.64.11 minikube.me
</span></span></code></pre></div><p>Verify it the <code>IP</code> is in the <code>/etc/hosts</code> with the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /etc/hosts <span class="p">|</span> tail -n <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">192.168.64.11 minikube.me
</span></span></code></pre></div><p>Now you can also call the service wit the <code>DNS</code>  <code>http://minikube.me:30506</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http http://minikube.me:30506
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">61</span>
</span></span><span class="line"><span class="cl">Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">03</span> May <span class="m">2020</span> 08:12:51 GMT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 1.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp-75d86849b-2gbps
</span></span></code></pre></div><h1 id="nginx-ingress">Nginx Ingress</h1>
<p>Now is time to create our <code>nginx ingress</code> for this we creat a file named <code>nginx-ingess.yaml</code>
where we point <code>/</code> to the <code>myapp</code> service on internal port <code>8080</code>.</p>
<p>Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span>  <span class="s2">&#34;apiVersion: networking.k8s.io/v1beta1 # for versions before 1.14 use extensions/v1beta1
</span></span></span><span class="line"><span class="cl"><span class="s2">kind: Ingress
</span></span></span><span class="line"><span class="cl"><span class="s2">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s2"> name: nginx-ingress
</span></span></span><span class="line"><span class="cl"><span class="s2"> namespace: dev
</span></span></span><span class="line"><span class="cl"><span class="s2"> annotations:
</span></span></span><span class="line"><span class="cl"><span class="s2">   nginx.ingress.kubernetes.io/rewrite-target: /</span><span class="nv">$1</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">spec:
</span></span></span><span class="line"><span class="cl"><span class="s2"> rules:
</span></span></span><span class="line"><span class="cl"><span class="s2"> - host: minikube.me
</span></span></span><span class="line"><span class="cl"><span class="s2">   http:
</span></span></span><span class="line"><span class="cl"><span class="s2">     paths:
</span></span></span><span class="line"><span class="cl"><span class="s2">     - path: /
</span></span></span><span class="line"><span class="cl"><span class="s2">       backend:
</span></span></span><span class="line"><span class="cl"><span class="s2">         serviceName: myapp
</span></span></span><span class="line"><span class="cl"><span class="s2">         servicePort: 8080&#34;</span>  <span class="p">|</span> &gt; nginx-ingess.yaml
</span></span></code></pre></div><p>Now let&rsquo;s also take a new <code>alias</code> in the game <code>kaf</code> is the alias for <code>kubectl -f</code> and let&rsquo;s apply the <code>nginx-ingess.yaml</code> file.
For this run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kaf nginx-ingess.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ingress.networking.k8s.io/nginx-ingress created
</span></span></code></pre></div><p>With <code>kubectl get ingress</code> you can list all ingress in the namespace.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get ingress
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME            CLASS    HOSTS         ADDRESS   PORTS   AGE
</span></span><span class="line"><span class="cl">nginx-ingress   &lt;none&gt;   minikube.me             <span class="m">80</span>      22s
</span></span></code></pre></div><h2 id="test-ingress">Test Ingress</h2>
<p>Open a browser now <code>http://minikube.me</code> or with <code>HTTPie</code> in a terminal.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http http://minikube.me
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">61</span>
</span></span><span class="line"><span class="cl">Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">03</span> May <span class="m">2020</span> 09:18:45 GMT
</span></span><span class="line"><span class="cl">Server: openresty/1.15.8.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 1.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp-75d86849b-v72vs
</span></span></code></pre></div><p>Now let&rsquo;s also deploy a second application and expose it as service.
Configure the <code>nginx ingress</code> also to the second service.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k create deployment myapp2 --image<span class="o">=</span>gcr.io/google-samples/hello-app:2.0
</span></span><span class="line"><span class="cl">k expose deployment myapp2 --port<span class="o">=</span><span class="m">8080</span> --type<span class="o">=</span>NodePort
</span></span></code></pre></div><p>Update the <code>nginx-ingess.yaml</code> file with <code>vi</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/v2/*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l">myapp2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></div><p>Check the <code>nginx-ingess.yaml</code> file with <code>cat nginx-ingess.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: networking.k8s.io/v1beta1 <span class="c1"># for versions before 1.14 use extensions/v1beta1</span>
</span></span><span class="line"><span class="cl">kind: Ingress
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl"> name: nginx-ingress
</span></span><span class="line"><span class="cl"> namespace: dev
</span></span><span class="line"><span class="cl"> annotations:
</span></span><span class="line"><span class="cl">   nginx.ingress.kubernetes.io/rewrite-target: /
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl"> rules:
</span></span><span class="line"><span class="cl"> - host: minikube.me
</span></span><span class="line"><span class="cl">   http:
</span></span><span class="line"><span class="cl">     paths:
</span></span><span class="line"><span class="cl">     - path: /
</span></span><span class="line"><span class="cl">       backend:
</span></span><span class="line"><span class="cl">         serviceName: myapp
</span></span><span class="line"><span class="cl">         servicePort: <span class="m">8080</span>     
</span></span><span class="line"><span class="cl">     - path: /v2
</span></span><span class="line"><span class="cl">       backend:
</span></span><span class="line"><span class="cl">         serviceName: myapp2
</span></span><span class="line"><span class="cl">         servicePort: <span class="m">8080</span>
</span></span></code></pre></div><p>Apply the changes with the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kaf nginx-ingess.yaml
</span></span><span class="line"><span class="cl">ingress.networking.k8s.io/nginx-ingress configured
</span></span></code></pre></div><p>Now we have one Ingress who point to 2 individual services.
Verify it with <code>HTTPie</code> or with the browser <code>http://minikube.me/</code> will give back <code>Version: 1.0.0</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http http://minikube.me/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">61</span>
</span></span><span class="line"><span class="cl">Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">03</span> May <span class="m">2020</span> 09:31:12 GMT
</span></span><span class="line"><span class="cl">Server: openresty/1.15.8.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 1.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp-75d86849b-v72vs
</span></span></code></pre></div><p>On the second route <code>http://minikube.me/v2</code> we get back <code>Version: 2.0.0</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http http://minikube.me/v2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">63</span>
</span></span><span class="line"><span class="cl">Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">03</span> May <span class="m">2020</span> 09:32:23 GMT
</span></span><span class="line"><span class="cl">Server: openresty/1.15.8.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, world!
</span></span><span class="line"><span class="cl">Version: 2.0.0
</span></span><span class="line"><span class="cl">Hostname: myapp2-548b98644f-rqqmp
</span></span></code></pre></div><h1 id="kubectl-cheat-sheet">kubectl Cheat Sheet</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get pods -o wide --show-labels  --field-selector<span class="o">=</span>status.phase<span class="o">=</span>Running  -w   <span class="p">|</span> grep -vi <span class="s2">&#34;Terminating&#34;</span>
</span></span><span class="line"><span class="cl">NAME                   READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES   LABELS
</span></span><span class="line"><span class="cl">web-6785d44d5-vb2wb    1/1     Running   <span class="m">1</span>          19h   172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>web,pod-template-hash<span class="o">=</span>6785d44d5
</span></span><span class="line"><span class="cl">web2                   1/1     Running   <span class="m">1</span>          19h   172.17.0.3   minikube   &lt;none&gt;           &lt;none&gt;            <span class="nv">run</span><span class="o">=</span>web2
</span></span><span class="line"><span class="cl">web2-8474c56fd-wk4kh   1/1     Running   <span class="m">1</span>          18h   172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>web2,pod-template-hash<span class="o">=</span>8474c56fd
</span></span></code></pre></div><h2 id="namespaces">Namespaces</h2>
<ul>
<li><code>kubectl get ns</code></li>
<li><code>k get ns</code></li>
<li><code>kgns</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k get ns
</span></span><span class="line"><span class="cl">NAME              STATUS   AGE
</span></span><span class="line"><span class="cl">default           Active   19h
</span></span><span class="line"><span class="cl">kube-node-lease   Active   19h
</span></span><span class="line"><span class="cl">kube-public       Active   19h
</span></span><span class="line"><span class="cl">kube-system       Active   19h
</span></span></code></pre></div><h2 id="delete-with-given-label">Delete with given label</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k delete all -l  <span class="nv">app</span><span class="o">=</span>web
</span></span></code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<pre tabindex="0"><code>sudo dscacheutil -flushcache;sudo killall -HUP mDNSResponder
</code></pre><hr>
<p><em>References:</em></p>
<blockquote>
<p><a href="https://kubernetes.io/docs/tasks/access-application-cluster/ingress-minikube/">ingress-minikube</a></p>
</blockquote>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://marzelwidmer.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://marzelwidmer.github.io/css/toc.css' />


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://marzelwidmer.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://marzelwidmer.github.io/js/github-style.js"></script>




</html>